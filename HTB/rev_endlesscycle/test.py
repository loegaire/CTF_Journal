from pwn import *
import sys

context.arch = 'amd64'

shellcode = b"\
    \x55\x48\x89\xE5\x68\x3E\x21\x01\x01\x81\x34\x24\x01\x01\x01\x01\x48\xB8\x74\x68\x65\x20\x66\x6C\x61\x67\x50\x48\xB8\x57\x68\x61\x74\x20\x69\x73\x20\x50\x6A\x01\x58\x6A\x01\x5F\x6A\x12\x5A\x48\x89\xE6\x0F\x05\x48\x81\xEC\x00\x01\x00\x00\x49\x89\xE4\x31\xC0\x31\xFF\x31\xD2\xB6\x01\x4C\x89\xE6\x0F\x05\x48\x85\xC0\x7E\x32\x6A\x1A\x58\x4C\x89\xE1\x48\x01\xC8\x81\x31\xFE\xCA\xEF\xBE\x48\x83\xC1\x04\x48\x39\xC1\x72\xF1\x4C\x89\xE7\x48\x8D\x35\x12\x00\x00\x00\x48\xC7\xC1\x1A\x00\x00\x00\xFC\xF3\xA6\x0F\x94\xC0\x0F\xB6\xC0\xC9\xC3\xB6\x9E\xAD\xC5\x92\xFA\xDF\xD5\xA1\xA8\xDC\xC7\xCE\xA4\x8B\xE1\x8A\xA2\xDC\xE1\x89\xFA\x9D\xD2\x9A\xB7"

# Create an executable memory region
shellcode_address = 0xdead0000  # Choose an arbitrary address
shellcode_executable = asm(f"jmp {shellcode_address}") + shellcode

# Run the shellcode
p = process(['/usr/bin/env', 'bash', '-c', 'exec -a shellcode /bin/sh'])
p.sendline(b"echo Executing shellcode...")
p.sendline(b"cat /proc/self/maps")  # Check memory layout
p.sendline(shellcode_executable)
p.interactive()

